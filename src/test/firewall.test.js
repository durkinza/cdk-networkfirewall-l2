"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("aws-cdk-lib/assertions");
const ec2 = require("aws-cdk-lib/aws-ec2");
const cdk = require("aws-cdk-lib/core");
const NetFW = require("../lib");
test('Default property', () => {
    // GIVEN
    const stack = new cdk.Stack();
    const vpc = new ec2.Vpc(stack, 'MyTestVpc', {
        ipAddresses: ec2.IpAddresses.cidr('10.0.0.0/16'),
    });
    // WHEN
    const policy = new NetFW.FirewallPolicy(stack, 'MyNetworkFirewallPolicy', {
        statelessDefaultActions: [NetFW.StatelessStandardAction.DROP],
        statelessFragmentDefaultActions: [NetFW.StatelessStandardAction.DROP],
    });
    new NetFW.Firewall(stack, 'MyNetworkFirewall1', {
        vpc: vpc,
        policy: policy,
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::NetworkFirewall::Firewall', {
        SubnetMappings: [
            {
                SubnetId: {
                    Ref: 'MyTestVpcPublicSubnet1SubnetA7B59A2C',
                },
            },
            {
                SubnetId: {
                    Ref: 'MyTestVpcPublicSubnet2SubnetBE93625D',
                },
            },
        ],
        VpcId: {
            Ref: 'MyTestVpcE144EEF4',
        },
    });
});
test('Can get firewall name', () => {
    // GIVEN
    const stack = new cdk.Stack();
    const vpc = new ec2.Vpc(stack, 'MyTestVpc', {
        ipAddresses: ec2.IpAddresses.cidr('10.0.0.0/16'),
    });
    const policy = new NetFW.FirewallPolicy(stack, 'MyNetworkFirewallPolicy', {
        statelessDefaultActions: [NetFW.StatelessStandardAction.DROP],
        statelessFragmentDefaultActions: [NetFW.StatelessStandardAction.DROP],
    });
    const firewall = new NetFW.Firewall(stack, 'MyNetworkFirewall2', {
        vpc: vpc,
        policy: policy,
    });
    // WHEN
    new cdk.CfnResource(stack, 'Res', {
        type: 'Test::Resource',
        properties: {
            FirewallName: firewall.firewallId,
        },
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('Test::Resource', {
        FirewallName: {
            Ref: 'MyNetworkFirewall02A8AE68',
        },
    });
});
test('Can get firewall by name', () => {
    // GIVEN
    const stack = new cdk.Stack();
    const firewall = NetFW.Firewall.fromFirewallName(stack, 'MyNetworkFirewall3', 'MyFirewall');
    // WHEN
    new cdk.CfnResource(stack, 'Res', {
        type: 'Test::Resource',
        properties: {
            FirewallName: firewall.firewallId,
        },
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('Test::Resource', {
        FirewallName: 'MyFirewall',
    });
});
test('firewall name is verified', () => {
    // GIVEN
    const stack = new cdk.Stack();
    const vpc = new ec2.Vpc(stack, 'MyTestVpc', {
        ipAddresses: ec2.IpAddresses.cidr('10.0.0.0/16'),
    });
    const policy = new NetFW.FirewallPolicy(stack, 'MyNetworkFirewallPolicy', {
        statelessDefaultActions: [NetFW.StatelessStandardAction.DROP],
        statelessFragmentDefaultActions: [NetFW.StatelessStandardAction.DROP],
    });
    // WHEN
    expect(() => {
        new NetFW.Firewall(stack, 'MyNetworkFirewall4', {
            vpc: vpc,
            policy: policy,
            firewallName: 'MyFirewall%3',
        });
        // THEN
    }).toThrow('firewallName must be non-empty and contain only letters, numbers, and dashes, got: \'MyFirewall%3\'');
});
test('Can provide Policy by Arn', () => {
    // GIVEN
    const stack = new cdk.Stack();
    const vpc = new ec2.Vpc(stack, 'MyTestVpc', {
        ipAddresses: ec2.IpAddresses.cidr('10.0.0.0/16'),
    });
    const policy = NetFW.FirewallPolicy.fromFirewallPolicyArn(stack, 'MyNetworkFirewallPolicy', 'arn:aws:network-firewall:us-east-1:012345678910:firewall-policy/MyNetworkFirewallPolicy645720A6');
    // WHEN
    new NetFW.Firewall(stack, 'MyNetworkFirewall5', {
        vpc: vpc,
        policy: policy,
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::NetworkFirewall::Firewall', {
        SubnetMappings: [
            {
                SubnetId: {
                    Ref: 'MyTestVpcPublicSubnet1SubnetA7B59A2C',
                },
            },
            {
                SubnetId: {
                    Ref: 'MyTestVpcPublicSubnet2SubnetBE93625D',
                },
            },
        ],
        VpcId: {
            Ref: 'MyTestVpcE144EEF4',
        },
    });
});
test('Can provide full props', () => {
    // GIVEN
    const stack = new cdk.Stack();
    const vpc = new ec2.Vpc(stack, 'MyTestVpc', {
        ipAddresses: ec2.IpAddresses.cidr('10.0.0.0/16'),
    });
    const policy = new NetFW.FirewallPolicy(stack, 'MyNetworkFirewallPolicy', {
        statelessDefaultActions: [NetFW.StatelessStandardAction.DROP],
        statelessFragmentDefaultActions: [NetFW.StatelessStandardAction.DROP],
    });
    // WHEN
    new NetFW.Firewall(stack, 'MyNetworkFirewall6', {
        firewallName: 'MyFirewall',
        vpc: vpc,
        policy: policy,
        subnetMappings: vpc.selectSubnets({ subnetType: ec2.SubnetType.PUBLIC }),
        description: 'A test firewall',
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::NetworkFirewall::Firewall', {
        FirewallName: 'MyFirewall',
        FirewallPolicyArn: {
            'Fn::GetAtt': [
                'MyNetworkFirewallPolicy645720A6',
                'FirewallPolicyArn',
            ],
        },
        SubnetMappings: [
            {
                SubnetId: {
                    Ref: 'MyTestVpcPublicSubnet1SubnetA7B59A2C',
                },
            },
            {
                SubnetId: {
                    Ref: 'MyTestVpcPublicSubnet2SubnetBE93625D',
                },
            },
        ],
        VpcId: {
            Ref: 'MyTestVpcE144EEF4',
        },
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlyZXdhbGwudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImZpcmV3YWxsLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx1REFBa0Q7QUFDbEQsMkNBQTJDO0FBQzNDLHdDQUF3QztBQUN4QyxnQ0FBZ0M7QUFFaEMsSUFBSSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtJQUM1QixRQUFRO0lBQ1IsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDOUIsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxXQUFXLEVBQUU7UUFDMUMsV0FBVyxFQUFFLEdBQUcsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQztLQUNqRCxDQUFDLENBQUM7SUFFSCxPQUFPO0lBQ1AsTUFBTSxNQUFNLEdBQUcsSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSx5QkFBeUIsRUFBRTtRQUN4RSx1QkFBdUIsRUFBRSxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLENBQUM7UUFDN0QsK0JBQStCLEVBQUUsQ0FBQyxLQUFLLENBQUMsdUJBQXVCLENBQUMsSUFBSSxDQUFDO0tBQ3RFLENBQUMsQ0FBQztJQUNILElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsb0JBQW9CLEVBQUU7UUFDOUMsR0FBRyxFQUFFLEdBQUc7UUFDUixNQUFNLEVBQUUsTUFBTTtLQUNmLENBQUMsQ0FBQztJQUVILE9BQU87SUFDUCxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxnQ0FBZ0MsRUFBRTtRQUNoRixjQUFjLEVBQUU7WUFDZDtnQkFDRSxRQUFRLEVBQUU7b0JBQ1IsR0FBRyxFQUFFLHNDQUFzQztpQkFDNUM7YUFDRjtZQUNEO2dCQUNFLFFBQVEsRUFBRTtvQkFDUixHQUFHLEVBQUUsc0NBQXND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UUFDMUIsaUJBQWlCLEVBQUU7WUFDakIsWUFBWSxFQUFFO2dCQUNaLGlDQUFpQztnQkFDakMsbUJBQW1CO2FBQ3BCO1NBQ0Y7UUFDRCxjQUFjLEVBQUU7WUFDZDtnQkFDRSxRQUFRLEVBQUU7b0JBQ1IsR0FBRyxFQUFFLHNDQUFzQztpQkFDNUM7YUFDRjtZQUNEO2dCQUNFLFFBQVEsRUFBRTtvQkFDUixHQUFHLEVBQUUsc0NBQXNDO2lCQUM1QzthQUNGO1NBQ0Y7UUFDRCxLQUFLLEVBQUU7WUFDTCxHQUFHLEVBQUUsbUJBQW1CO1NBQ3pCO0tBQ0YsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZW1wbGF0ZSB9IGZyb20gJ2F3cy1jZGstbGliL2Fzc2VydGlvbnMnO1xuaW1wb3J0ICogYXMgZWMyIGZyb20gJ2F3cy1jZGstbGliL2F3cy1lYzInO1xuaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliL2NvcmUnO1xuaW1wb3J0ICogYXMgTmV0RlcgZnJvbSAnLi4vbGliJztcblxudGVzdCgnRGVmYXVsdCBwcm9wZXJ0eScsICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG4gIGNvbnN0IHZwYyA9IG5ldyBlYzIuVnBjKHN0YWNrLCAnTXlUZXN0VnBjJywge1xuICAgIGlwQWRkcmVzc2VzOiBlYzIuSXBBZGRyZXNzZXMuY2lkcignMTAuMC4wLjAvMTYnKSxcbiAgfSk7XG5cbiAgLy8gV0hFTlxuICBjb25zdCBwb2xpY3kgPSBuZXcgTmV0RlcuRmlyZXdhbGxQb2xpY3koc3RhY2ssICdNeU5ldHdvcmtGaXJld2FsbFBvbGljeScsIHtcbiAgICBzdGF0ZWxlc3NEZWZhdWx0QWN0aW9uczogW05ldEZXLlN0YXRlbGVzc1N0YW5kYXJkQWN0aW9uLkRST1BdLFxuICAgIHN0YXRlbGVzc0ZyYWdtZW50RGVmYXVsdEFjdGlvbnM6IFtOZXRGVy5TdGF0ZWxlc3NTdGFuZGFyZEFjdGlvbi5EUk9QXSxcbiAgfSk7XG4gIG5ldyBOZXRGVy5GaXJld2FsbChzdGFjaywgJ015TmV0d29ya0ZpcmV3YWxsMScsIHtcbiAgICB2cGM6IHZwYyxcbiAgICBwb2xpY3k6IHBvbGljeSxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpOZXR3b3JrRmlyZXdhbGw6OkZpcmV3YWxsJywge1xuICAgIFN1Ym5ldE1hcHBpbmdzOiBbXG4gICAgICB7XG4gICAgICAgIFN1Ym5ldElkOiB7XG4gICAgICAgICAgUmVmOiAnTXlUZXN0VnBjUHVibGljU3VibmV0MVN1Ym5ldEE3QjU5QTJDJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIFN1Ym5ldElkOiB7XG4gICAgICAgICAgUmVmOiAnTXlUZXN0VnBjUHVibGljU3VibmV0MlN1Ym5ldEJFOTM2MjVEJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgXSxcbiAgICBWcGNJZDoge1xuICAgICAgUmVmOiAnTXlUZXN0VnBjRTE0NEVFRjQnLFxuICAgIH0sXG4gIH0pO1xufSk7XG50ZXN0KCdDYW4gZ2V0IGZpcmV3YWxsIG5hbWUnLCAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICBjb25zdCB2cGMgPSBuZXcgZWMyLlZwYyhzdGFjaywgJ015VGVzdFZwYycsIHtcbiAgICBpcEFkZHJlc3NlczogZWMyLklwQWRkcmVzc2VzLmNpZHIoJzEwLjAuMC4wLzE2JyksXG4gIH0pO1xuICBjb25zdCBwb2xpY3kgPSBuZXcgTmV0RlcuRmlyZXdhbGxQb2xpY3koc3RhY2ssICdNeU5ldHdvcmtGaXJld2FsbFBvbGljeScsIHtcbiAgICBzdGF0ZWxlc3NEZWZhdWx0QWN0aW9uczogW05ldEZXLlN0YXRlbGVzc1N0YW5kYXJkQWN0aW9uLkRST1BdLFxuICAgIHN0YXRlbGVzc0ZyYWdtZW50RGVmYXVsdEFjdGlvbnM6IFtOZXRGVy5TdGF0ZWxlc3NTdGFuZGFyZEFjdGlvbi5EUk9QXSxcbiAgfSk7XG5cbiAgY29uc3QgZmlyZXdhbGwgPSBuZXcgTmV0RlcuRmlyZXdhbGwoc3RhY2ssICdNeU5ldHdvcmtGaXJld2FsbDInLCB7XG4gICAgdnBjOiB2cGMsXG4gICAgcG9saWN5OiBwb2xpY3ksXG4gIH0pO1xuICAvLyBXSEVOXG4gIG5ldyBjZGsuQ2ZuUmVzb3VyY2Uoc3RhY2ssICdSZXMnLCB7XG4gICAgdHlwZTogJ1Rlc3Q6OlJlc291cmNlJyxcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICBGaXJld2FsbE5hbWU6IGZpcmV3YWxsLmZpcmV3YWxsSWQsXG4gICAgfSxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnVGVzdDo6UmVzb3VyY2UnLCB7XG4gICAgRmlyZXdhbGxOYW1lOiB7XG4gICAgICBSZWY6ICdNeU5ldHdvcmtGaXJld2FsbDAyQThBRTY4JyxcbiAgICB9LFxuICB9KTtcbn0pO1xuXG50ZXN0KCdDYW4gZ2V0IGZpcmV3YWxsIGJ5IG5hbWUnLCAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICBjb25zdCBmaXJld2FsbCA9IE5ldEZXLkZpcmV3YWxsLmZyb21GaXJld2FsbE5hbWUoc3RhY2ssICdNeU5ldHdvcmtGaXJld2FsbDMnLCAnTXlGaXJld2FsbCcpO1xuICAvLyBXSEVOXG4gIG5ldyBjZGsuQ2ZuUmVzb3VyY2Uoc3RhY2ssICdSZXMnLCB7XG4gICAgdHlwZTogJ1Rlc3Q6OlJlc291cmNlJyxcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICBGaXJld2FsbE5hbWU6IGZpcmV3YWxsLmZpcmV3YWxsSWQsXG4gICAgfSxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnVGVzdDo6UmVzb3VyY2UnLCB7XG4gICAgRmlyZXdhbGxOYW1lOiAnTXlGaXJld2FsbCcsXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2ZpcmV3YWxsIG5hbWUgaXMgdmVyaWZpZWQnLCAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICBjb25zdCB2cGMgPSBuZXcgZWMyLlZwYyhzdGFjaywgJ015VGVzdFZwYycsIHtcbiAgICBpcEFkZHJlc3NlczogZWMyLklwQWRkcmVzc2VzLmNpZHIoJzEwLjAuMC4wLzE2JyksXG4gIH0pO1xuICBjb25zdCBwb2xpY3kgPSBuZXcgTmV0RlcuRmlyZXdhbGxQb2xpY3koc3RhY2ssICdNeU5ldHdvcmtGaXJld2FsbFBvbGljeScsIHtcbiAgICBzdGF0ZWxlc3NEZWZhdWx0QWN0aW9uczogW05ldEZXLlN0YXRlbGVzc1N0YW5kYXJkQWN0aW9uLkRST1BdLFxuICAgIHN0YXRlbGVzc0ZyYWdtZW50RGVmYXVsdEFjdGlvbnM6IFtOZXRGVy5TdGF0ZWxlc3NTdGFuZGFyZEFjdGlvbi5EUk9QXSxcbiAgfSk7XG4gIC8vIFdIRU5cbiAgZXhwZWN0KCgpID0+IHtcbiAgICBuZXcgTmV0RlcuRmlyZXdhbGwoc3RhY2ssICdNeU5ldHdvcmtGaXJld2FsbDQnLCB7XG4gICAgICB2cGM6IHZwYyxcbiAgICAgIHBvbGljeTogcG9saWN5LFxuICAgICAgZmlyZXdhbGxOYW1lOiAnTXlGaXJld2FsbCUzJyxcbiAgICB9KTtcbiAgLy8gVEhFTlxuICB9KS50b1Rocm93KCdmaXJld2FsbE5hbWUgbXVzdCBiZSBub24tZW1wdHkgYW5kIGNvbnRhaW4gb25seSBsZXR0ZXJzLCBudW1iZXJzLCBhbmQgZGFzaGVzLCBnb3Q6IFxcJ015RmlyZXdhbGwlM1xcJycpO1xufSk7XG5cbnRlc3QoJ0NhbiBwcm92aWRlIFBvbGljeSBieSBBcm4nLCAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICBjb25zdCB2cGMgPSBuZXcgZWMyLlZwYyhzdGFjaywgJ015VGVzdFZwYycsIHtcbiAgICBpcEFkZHJlc3NlczogZWMyLklwQWRkcmVzc2VzLmNpZHIoJzEwLjAuMC4wLzE2JyksXG4gIH0pO1xuICBjb25zdCBwb2xpY3kgPSBOZXRGVy5GaXJld2FsbFBvbGljeS5mcm9tRmlyZXdhbGxQb2xpY3lBcm4oc3RhY2ssICdNeU5ldHdvcmtGaXJld2FsbFBvbGljeScsXG4gICAgJ2Fybjphd3M6bmV0d29yay1maXJld2FsbDp1cy1lYXN0LTE6MDEyMzQ1Njc4OTEwOmZpcmV3YWxsLXBvbGljeS9NeU5ldHdvcmtGaXJld2FsbFBvbGljeTY0NTcyMEE2JyxcbiAgKTtcbiAgLy8gV0hFTlxuICBuZXcgTmV0RlcuRmlyZXdhbGwoc3RhY2ssICdNeU5ldHdvcmtGaXJld2FsbDUnLCB7XG4gICAgdnBjOiB2cGMsXG4gICAgcG9saWN5OiBwb2xpY3ksXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6TmV0d29ya0ZpcmV3YWxsOjpGaXJld2FsbCcsIHtcbiAgICBTdWJuZXRNYXBwaW5nczogW1xuICAgICAge1xuICAgICAgICBTdWJuZXRJZDoge1xuICAgICAgICAgIFJlZjogJ015VGVzdFZwY1B1YmxpY1N1Ym5ldDFTdWJuZXRBN0I1OUEyQycsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBTdWJuZXRJZDoge1xuICAgICAgICAgIFJlZjogJ015VGVzdFZwY1B1YmxpY1N1Ym5ldDJTdWJuZXRCRTkzNjI1RCcsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIF0sXG4gICAgVnBjSWQ6IHtcbiAgICAgIFJlZjogJ015VGVzdFZwY0UxNDRFRUY0JyxcbiAgICB9LFxuICB9KTtcbn0pO1xuXG50ZXN0KCdDYW4gcHJvdmlkZSBmdWxsIHByb3BzJywgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcbiAgY29uc3QgdnBjID0gbmV3IGVjMi5WcGMoc3RhY2ssICdNeVRlc3RWcGMnLCB7XG4gICAgaXBBZGRyZXNzZXM6IGVjMi5JcEFkZHJlc3Nlcy5jaWRyKCcxMC4wLjAuMC8xNicpLFxuICB9KTtcbiAgY29uc3QgcG9saWN5ID0gbmV3IE5ldEZXLkZpcmV3YWxsUG9saWN5KHN0YWNrLCAnTXlOZXR3b3JrRmlyZXdhbGxQb2xpY3knLCB7XG4gICAgc3RhdGVsZXNzRGVmYXVsdEFjdGlvbnM6IFtOZXRGVy5TdGF0ZWxlc3NTdGFuZGFyZEFjdGlvbi5EUk9QXSxcbiAgICBzdGF0ZWxlc3NGcmFnbWVudERlZmF1bHRBY3Rpb25zOiBbTmV0RlcuU3RhdGVsZXNzU3RhbmRhcmRBY3Rpb24uRFJPUF0sXG4gIH0pO1xuICAvLyBXSEVOXG4gIG5ldyBOZXRGVy5GaXJld2FsbChzdGFjaywgJ015TmV0d29ya0ZpcmV3YWxsNicsIHtcbiAgICBmaXJld2FsbE5hbWU6ICdNeUZpcmV3YWxsJyxcbiAgICB2cGM6IHZwYyxcbiAgICBwb2xpY3k6IHBvbGljeSxcbiAgICBzdWJuZXRNYXBwaW5nczogdnBjLnNlbGVjdFN1Ym5ldHMoeyBzdWJuZXRUeXBlOiBlYzIuU3VibmV0VHlwZS5QVUJMSUMgfSksXG4gICAgZGVzY3JpcHRpb246ICdBIHRlc3QgZmlyZXdhbGwnLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6Ok5ldHdvcmtGaXJld2FsbDo6RmlyZXdhbGwnLCB7XG4gICAgRmlyZXdhbGxOYW1lOiAnTXlGaXJld2FsbCcsXG4gICAgRmlyZXdhbGxQb2xpY3lBcm46IHtcbiAgICAgICdGbjo6R2V0QXR0JzogW1xuICAgICAgICAnTXlOZXR3b3JrRmlyZXdhbGxQb2xpY3k2NDU3MjBBNicsXG4gICAgICAgICdGaXJld2FsbFBvbGljeUFybicsXG4gICAgICBdLFxuICAgIH0sXG4gICAgU3VibmV0TWFwcGluZ3M6IFtcbiAgICAgIHtcbiAgICAgICAgU3VibmV0SWQ6IHtcbiAgICAgICAgICBSZWY6ICdNeVRlc3RWcGNQdWJsaWNTdWJuZXQxU3VibmV0QTdCNTlBMkMnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgU3VibmV0SWQ6IHtcbiAgICAgICAgICBSZWY6ICdNeVRlc3RWcGNQdWJsaWNTdWJuZXQyU3VibmV0QkU5MzYyNUQnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICBdLFxuICAgIFZwY0lkOiB7XG4gICAgICBSZWY6ICdNeVRlc3RWcGNFMTQ0RUVGNCcsXG4gICAgfSxcbiAgfSk7XG59KTtcbiJdfQ==